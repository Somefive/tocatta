{"version":3,"sources":["../../components/system.js"],"names":["Vue","component","props","template","methods","click","event","stopPropagation","remove","$emit","measure","leftDrag","leftDragging","start","clientX","offset","leftDragStart","leftDragEnd","rightDrag","rightDragging","end","rightDragStart","rightDragEnd","data","mode","computed","measureEditable","measureVisible","systemEditable","editable","systemVisible","visibilityClass","changeMeasureVisibility","changeMeasureEditability","system","removeMeasure","index","measures","indexOf","splice","x","layerX","every","e","push","Measure","upDragStart","offsetY","clientY","y","bottom","height","upDragging","upDragEnd","upDrag","newY","newHeight","downDragStart","downDragging","downDragEnd","downDrag","removeSystem","item","systems","layerY","System"],"mappings":"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","file":"system.js","sourcesContent":["/**\n * Created by somefive on 17-7-5.\n */\nVue.component('measure-item',{\n\tprops: ['measure', 'editable'],\n\ttemplate:\n\t\t`<div class=\"measure\" @click=\"click\">\n\t\t\t<div class=\"left-stretch horizontal-boundary-stretch\" v-show=\"editable\"\n\t\t\t\t@mousemove=\"leftDrag\" @mousedown=\"leftDragStart\"\n\t\t\t\t@mouseup=\"leftDragEnd\" @mouseleave=\"leftDragEnd\">\n\t\t\t\t<i class=\"fa fa-angle-left center-align\"></i></div>\n\t\t\t<div class=\"right-stretch horizontal-boundary-stretch\" v-show=\"editable\"\n\t\t\t\t@mousemove=\"rightDrag\" @mousedown=\"rightDragStart\"\n\t\t\t\t@mouseup=\"rightDragEnd\" @mouseleave=\"rightDragEnd\">\n\t\t\t\t<i class=\"fa fa-angle-right center-align\"></i></div>\n\t\t\t<div class=\"sector-edit-btn trash-btn\" v-on:click=\"remove\" v-show=\"editable\"><i class=\"fa fa-trash\"></i></div>\n\t\t</div>`,\n\tmethods: {\n\t\tclick: function(event) {\n\t\t\tevent.stopPropagation();\n\t\t},\n\t\tremove: function() {\n\t\t\tthis.$emit('remove', this.measure);\n\t\t},\n\t\tleftDrag: function(event) {\n\t\t\tif (!this.leftDragging) return;\n\t\t\tthis.measure.start = event.clientX - this.offset;\n\t\t},\n\t\tleftDragStart: function(event) {\n\t\t\tthis.offset = event.clientX - this.measure.start;\n\t\t\tthis.leftDragging = true;\n\t\t},\n\t\tleftDragEnd: function(event) {\n\t\t\tthis.leftDrag(event);\n\t\t\tthis.leftDragging = false;\n\t\t},\n\t\trightDrag: function(event) {\n\t\t\tif (!this.rightDragging) return;\n\t\t\tthis.measure.end = event.clientX - this.offset;\n\t\t},\n\t\trightDragStart: function(event) {\n\t\t\tthis.offset = event.clientX - this.measure.end;\n\t\t\tthis.rightDragging = true;\n\t\t},\n\t\trightDragEnd: function(event) {\n\t\t\tthis.rightDrag(event);\n\t\t\tthis.rightDragging = false;\n\t\t}\n\t}\n});\nVue.component('system-item',{\n\tprops: ['system', 'editable'],\n\ttemplate:\n\t\t`<div class=\"widget system\" @click=\"click\" v-show=\"systemVisible\"\n\t\t\t\tv-bind:style=\"{top: system.y + 'px', height: system.height + 'px'}\">\n\t\t\t\t<div class=\"up-stretch vertical-boundary-stretch\" v-show=\"systemEditable\"\n\t\t\t\t\t@mousemove=\"upDrag\" @mousedown=\"upDragStart\"\n\t\t\t\t\t@mouseup=\"upDragEnd\" @mouseleave=\"upDragEnd\">\n\t\t\t\t\t<i class=\"fa fa-angle-up\"></i></div>\n\t\t\t\t<div class=\"down-stretch vertical-boundary-stretch\" v-show=\"systemEditable\"\n\t\t\t\t\t@mousemove=\"downDrag\" @mousedown=\"downDragStart\"\n\t\t\t\t\t@mouseup=\"downDragEnd\" @mouseleave=\"downDragEnd\">\n\t\t\t\t\t<i class=\"fa fa-angle-down\"></i></div>\n\t\t\t\t<measure-item v-bind:editable=\"measureEditable\" v-on:remove=\"removeMeasure\"\n\t\t\t\t\tv-for=\"measure in system.measures\" v-bind:measure=\"measure\"\n\t\t\t\t\tv-bind:style=\"{left: measure.start + 'px', width: (measure.end-measure.start+1) + 'px'}\"\n\t\t\t\t\tv-show=\"measureVisible\"></measure-item>\n\t\t\t\t<div class=\"sector-edit-btn trash-btn\" v-on:click=\"remove\" v-show=\"systemEditable\"><i class=\"fa fa-trash\"></i></div>\n\t\t\t\t<div class=\"sector-edit-btn change-visibility-btn\" v-on:click=\"changeMeasureVisibility\"><i class=\"fa\" v-bind:class=\"visibilityClass\"></i></div>\n\t\t\t\t<div class=\"sector-edit-btn change-editability-btn\" v-on:click=\"changeMeasureEditability\" v-show=\"measureVisible\"><i class=\"fa fa-edit\"></i></div>\n\t\t\t</div>`,\n\tdata: function() {\n\t\treturn {\n\t\t\tmode: \"visible\"\n\t\t}\n\t},\n\tcomputed: {\n\t\tmeasureEditable: function() { return this.mode == \"edit-measure\"; },\n\t\tmeasureVisible: function() { return this.mode == \"view-measure\" || this.mode == \"edit-measure\" },\n\t\tsystemEditable: function() { return this.mode != \"invisible\" && this.editable; },\n\t\tsystemVisible: function() { return this.mode != \"invisible\"; },\n\t\tvisibilityClass: function() { return this.measureVisible?\"fa-eye-slash\":\"fa-eye\"}\n\t},\n\tmethods: {\n\t\tchangeMeasureVisibility: function() {\n\t\t\tif (this.measureVisible) this.mode = \"visible\";\n\t\t\telse this.mode = \"view-measure\";\n\t\t},\n\t\tchangeMeasureEditability: function() {\n\t\t\tif (this.measureEditable) this.mode = \"view-measure\";\n\t\t\telse this.mode = \"edit-measure\";\n\t\t},\n\t\tremove: function() {\n\t\t\tthis.$emit('remove', this.system);\n\t\t},\n\t\tremoveMeasure: function(measure) {\n\t\t\tlet index = this.system.measures.indexOf(measure);\n\t\t\tif (index >= 0) this.system.measures.splice(index,1);\n\t\t},\n\t\tclick: function(event) {\n\t\t\tif (this.measureEditable) {\n\t\t\t\tlet x = event.layerX;\n\t\t\t\tif (this.system.measures.every((e) => {\n\t\t\t\t\t\treturn x < e.start || x > e.end;\n\t\t\t\t\t})) {\n\t\t\t\t\tthis.system.measures.push(new Measure(x, x+30));\n\t\t\t\t}\n\t\t\t}\n\t\t\tevent.stopPropagation();\n\t\t},\n\t\tupDragStart: function(event) {\n\t\t\tthis.system.offsetY = event.clientY - this.system.y;\n\t\t\tthis.system.bottom = this.system.y + this.system.height;\n\t\t\tthis.system.upDragging = true;\n\t\t},\n\t\tupDragEnd: function(event) {\n\t\t\tthis.upDrag(event);\n\t\t\tthis.system.upDragging = false;\n\t\t},\n\t\tupDrag: function(event) {\n\t\t\tif (!this.system.upDragging) return;\n\t\t\tlet newY = event.clientY - this.system.offsetY;\n\t\t\tlet newHeight = this.system.bottom - newY;\n\t\t\tif (newHeight > 30) {\n\t\t\t\tthis.system.y = newY;\n\t\t\t\tthis.system.height = newHeight;\n\t\t\t}\n\t\t},\n\t\tdownDragStart: function(event) {\n\t\t\tthis.system.offsetY = event.clientY - this.system.y - this.system.height;\n\t\t\tthis.system.downDragging = true;\n\t\t},\n\t\tdownDragEnd: function(event) {\n\t\t\tthis.downDrag(event);\n\t\t\tthis.system.downDragging = false;\n\t\t},\n\t\tdownDrag: function(event) {\n\t\t\tif (!this.system.downDragging) return;\n\t\t\tlet newY = event.clientY - this.system.offsetY;\n\t\t\tlet newHeight = newY - this.system.y;\n\t\t\tif (newHeight > 30) this.system.height = newHeight;\n\t\t}\n\t}\n});\nVue.component('system-items',{\n\tprops: ['systems', 'editable'],\n\ttemplate:\n\t\t`<div id=\"div-systems\" @click=\"click\">\n            <system-item v-for=\"system in systems\" v-bind:system=\"system\" v-bind:editable=\"editable\" v-on:remove=\"removeSystem\"></system-item>\n        </div>`,\n\tmethods: {\n\t\tremoveSystem: function(item) {\n\t\t\tlet index = this.systems.indexOf(item);\n\t\t\tif (index >= 0) this.systems.splice(index,1);\n\t\t},\n\t\tclick: function(event) {\n\t\t\tif (!this.editable) return;\n\t\t\tlet y = event.layerY;\n\t\t\tif (this.systems.every((e) => {\n\t\t\t\t\treturn y < e.y || y > (e.y+e.height);\n\t\t\t\t})) {\n\t\t\t\tthis.systems.push(new System(y, 30));\n\t\t\t}\n\t\t\tevent.stopPropagation();\n\t\t}\n\t}\n});"]}