{"version":3,"sources":["../mark.js"],"names":["app","imageFile","imageData","pageCanvas","sectorManager","readImage","file","fr","FileReader","readAsDataURL","onload","img","Image","src","result","scale","canvas","height","width","cX","cY","console","log","ctx","drawImage","displayWidth","displayLeftOffset","getImageData","load","require","config","paths","$","document","ready","BaseCanvas","getElementById","SectorManager","Vue","_Vue","el","data","message","systems","systemEditable","methods","autoGenerate","drawSystems","calcMeasures","openReadImageDialog","click","changeSystemEditable"],"mappings":";;AAAA;;;AAGA,IAAIA,YAAJ;AAAA,IAASC,kBAAT;AAAA,IAAoBC,kBAApB;AAAA,IAA+BC,mBAA/B;AAAA,IAA2CC,sBAA3C;AACA,SAASC,SAAT,CAAmBC,IAAnB,EAAyB;AACxBL,aAAYK,IAAZ;AACA,KAAIC,KAAK,IAAIC,UAAJ,EAAT;AACAD,IAAGE,aAAH,CAAiBH,IAAjB;AACAC,IAAGG,MAAH,GAAY,YAAW;AACtB,MAAIC,MAAM,IAAIC,KAAJ,EAAV;AACAD,MAAIE,GAAJ,GAAU,KAAKC,MAAf;AACAH,MAAID,MAAJ,GAAa,YAAW;AACvB,OAAIK,QAAQZ,WAAWa,MAAX,CAAkBC,MAAlB,GAAyB,KAAKA,MAA9B,GAAuCd,WAAWa,MAAX,CAAkBE,KAAlB,GAAwB,KAAKA,KAApE,GAA4Ef,WAAWa,MAAX,CAAkBC,MAAlB,GAAyB,KAAKA,MAA1G,GAAmHd,WAAWa,MAAX,CAAkBE,KAAlB,GAAwB,KAAKA,KAA5J;AACA,OAAID,SAAS,KAAKA,MAAL,GAAYF,KAAzB;AACA,OAAIG,QAAQ,KAAKA,KAAL,GAAWH,KAAvB;AACA,OAAII,KAAKhB,WAAWa,MAAX,CAAkBE,KAAlB,GAAwB,CAAjC;AAAA,OAAoCE,KAAKjB,WAAWa,MAAX,CAAkBC,MAAlB,GAAyB,CAAlE;AACAI,WAAQC,GAAR,CAAYH,KAAG,GAAH,GAAOC,EAAP,GAAU,KAAV,GAAgBF,KAAhB,GAAsB,KAAtB,GAA4BD,MAAxC;AACAd,cAAWoB,GAAX,CAAeC,SAAf,CAAyBb,GAAzB,EAA8BQ,KAAGD,QAAM,CAAvC,EAA0CE,KAAGH,SAAO,CAApD,EAAuDC,KAAvD,EAA8DD,MAA9D;AACAjB,OAAIyB,YAAJ,GAAmBP,KAAnB;AACAlB,OAAI0B,iBAAJ,GAAwBP,KAAGD,QAAM,CAAjC;AACAhB,eAAYC,WAAWoB,GAAX,CAAeI,YAAf,CAA4BR,KAAGD,QAAM,CAArC,EAAwCE,KAAGH,SAAO,CAAlD,EAAqDC,KAArD,EAA4DD,MAA5D,CAAZ;AACAb,iBAAcwB,IAAd,CAAmB1B,SAAnB;AACA;AACA,GAZD;AAaA,EAhBD;AAiBA;;AAED2B,QAAQC,MAAR,CAAe;AACdC,QAAO;AACN,YAAU;AADJ;AADO,CAAf;AAKAF,QAAQ,CAAC,QAAD,EAAW,cAAX,EAA2B,WAA3B,CAAR,EAAiD,UAASG,CAAT,EAAW;AAC3DA,GAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAU;AAC3B/B,eAAa,IAAIgC,UAAJ,CAAeF,SAASG,cAAT,CAAwB,aAAxB,CAAf,CAAb;AACAhC,kBAAgB,IAAIiC,aAAJ,EAAhB;AACA,EAHD;AAIA,CALD;AAMA,IAAIC,YAAJ;AACAT,QAAQ,CAAC,aAAD,CAAR,EAAyB,UAASU,IAAT,EAAc;AACtCD,OAAMC,IAAN;AACAV,SAAQ,CAAC,mBAAD,CAAR;AACA7B,OAAM,IAAIsC,GAAJ,CAAQ;AACbE,MAAI,cADS;AAEbC,QAAM;AACLC,YAAS,gBADJ;AAELC,YAAS,EAFJ;AAGLC,mBAAgB,KAHX;AAILnB,iBAAc,CAJT;AAKLC,sBAAmB;AALd,GAFO;AASbmB,WAAS;AACRC,iBAAc,wBAAW;AACxB1C,kBAAc2C,WAAd,CAA0B,IAA1B;AACA3C,kBAAc4C,YAAd;AACA,IAJO;AAKRC,wBAAqB,+BAAW;AAC/BhB,aAASG,cAAT,CAAwB,gBAAxB,EAA0Cc,KAA1C;AACA,IAPO;AAQRC,yBAAsB,gCAAW;AAChC,SAAKP,cAAL,GAAsB,CAAC,KAAKA,cAA5B;AACA;AAVO;AATI,EAAR,CAAN;AAsBA,CAzBD","file":"mark.js","sourcesContent":["/**\n * Created by somefive on 17-7-3.\n */\nlet app, imageFile, imageData, pageCanvas, sectorManager;\nfunction readImage(file) {\n\timageFile = file;\n\tlet fr = new FileReader();\n\tfr.readAsDataURL(file);\n\tfr.onload = function() {\n\t\tlet img = new Image();\n\t\timg.src = this.result;\n\t\timg.onload = function() {\n\t\t\tlet scale = pageCanvas.canvas.height/this.height < pageCanvas.canvas.width/this.width ? pageCanvas.canvas.height/this.height : pageCanvas.canvas.width/this.width;\n\t\t\tlet height = this.height*scale;\n\t\t\tlet width = this.width*scale;\n\t\t\tlet cX = pageCanvas.canvas.width/2, cY = pageCanvas.canvas.height/2;\n\t\t\tconsole.log(cX+\" \"+cY+\" - \"+width+\" - \"+height);\n\t\t\tpageCanvas.ctx.drawImage(img, cX-width/2, cY-height/2, width, height);\n\t\t\tapp.displayWidth = width;\n\t\t\tapp.displayLeftOffset = cX-width/2;\n\t\t\timageData = pageCanvas.ctx.getImageData(cX-width/2, cY-height/2, width, height);\n\t\t\tsectorManager.load(imageData);\n\t\t\t// sectorManager.drawSystems(true);\n\t\t}\n\t}\n}\n\nrequire.config({\n\tpaths: {\n\t\t'jquery': 'lib/jquery.min'\n\t}\n});\nrequire(['jquery', 'imageProcess', 'notations'], function($){\n\t$(document).ready(function(){\n\t\tpageCanvas = new BaseCanvas(document.getElementById('page-canvas'));\n\t\tsectorManager = new SectorManager();\n\t})\n});\nlet Vue;\nrequire(['lib/vue.min'], function(_Vue){\n\tVue = _Vue;\n\trequire(['components/system']);\n\tapp = new Vue({\n\t\tel: '#tocatta-app',\n\t\tdata: {\n\t\t\tmessage: 'Hello Tocatta!',\n\t\t\tsystems: [],\n\t\t\tsystemEditable: false,\n\t\t\tdisplayWidth: 0,\n\t\t\tdisplayLeftOffset: 0\n\t\t},\n\t\tmethods: {\n\t\t\tautoGenerate: function() {\n\t\t\t\tsectorManager.drawSystems(true);\n\t\t\t\tsectorManager.calcMeasures();\n\t\t\t},\n\t\t\topenReadImageDialog: function() {\n\t\t\t\tdocument.getElementById('btn-read-image').click();\n\t\t\t},\n\t\t\tchangeSystemEditable: function() {\n\t\t\t\tthis.systemEditable = !this.systemEditable;\n\t\t\t}\n\t\t}\n\t});\n});"]}